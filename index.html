<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Averitt Express Map Suite</title>
    <link href="css/lib/bootstrap.min.css" rel="stylesheet">
    <!-- BootStrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/themes/base/jquery-ui.css" rel="stylesheet"
        type="text/css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <!-- PapaParse -->
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <!-- CSS File-->
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script
        src="https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.min.js"></script>
    <!-- JavaScript Files-->
    <script src="js/index.js"></script>
    <script src="js/lib/us-states.js"></script>
    <script src="js/map-settings.js"></script>
    <script src="js/map-pathconf.js"></script>

</head>

<body>
    <!-- White Header With Red Logo -->
    <div class="header-row" style="background-color:white; height:75px">
        <div class="container mt-2" style="float: right;">
            <a href="https://www.insideaveritt.com/"><img src="images/2560px-Averitt_Express_logo.svg.png"
                    class="float-right col-3 mt-2" alt="AverittLogoHeader" /></a>
        </div>
    </div>

    <!-- Averitt Red Header -->
    <div class="header-row" style="background-color:#c3202f; height: 25px; border-style: solid none solid none;"></div>

    <div class="box">
        <!--        <div class="">-->
        <div class="card vh-100 col-2 d-flex justify-content-left" id="NavBar2"
            style="grid-row-end:span 1; background-color:#333333; border-radius: 0px; min-width:228px ; max-width:228px; overflow:hidden; overflow-y:scroll; scrollbar-width: 0; display: flex; align-items: flex-start; border-style: none solid none none none;">


            <!-- NAVIGATION BAR CARDS -->
            <div id="Navbar">

                <!-- SCHEDULED SHIPMENTS -->
                <div class="card text-center mt-1"
                    style="border-color:#c3202f; border-radius:10px; border-width:3px; width:200px; height:auto; right: 12px;">
                    <div class="row justify-content-center d-flex">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Scheduled Shipment</b></h6>
                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent just" id="btnToggleScheduled"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>
                    </div>

                    <div id="txtSchedCard">
                        <div class="d-flex justify-content-center">
                            <input type="file" id="ScheduledPathFile" style="display: none;" accept="csv" required />
                            <button id="ScheduledPathButton" onmouseover="this.style.opacity = '0.6'"
                                onmouseout="this.style.opacity = '1'" class="col-6.5 m-1 px-2">Choose File</button>
                        </div>
                        <div class="row justify-content-center d-flex" style="color:#c3202f">
                            <h6 class="text-center" id="noFileScheduled"><b>No File Chosen</b></h6>
                        </div>
                        <div class="row justify-content-center d-flex">
                            <label class="text-center mb-4" style="font-size:15px">Show Scheduled Path(s)<input
                                    type="checkbox" class="m-1" id="SidebarScheduledShow"> </label>
                        </div>
                    </div>
                </div>

                <!-- ACTUAL SHIPMENTS-->
                <div class="card text-center mt-1"
                    style="border-color:#c3202f; border-radius:10px; border-width:3px; width:200px; height:auto; right:12px">
                    <div class="row justify-content-center d-flex">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Actual Shipments</b></h6>
                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent" id="btnToggleActual"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>
                    </div>

                    <div id="txtActualCard">
                        <div class="d-flex justify-content-center">
                            <input type="file" id="ActualPathFile" style="display: none;" accept="csv" required />
                            <button id="ActualPathButton" onmouseover="this.style.opacity = '0.6'"
                                onmouseout="this.style.opacity = '1'" class="col-6.5 m-1 px-2">Choose File</button>
                        </div>
                        <div class="row justify-content-center d-flex" style="color:#c3202f">
                            <h6 class="text-center" id="noFileActual"><b>No File Chosen</b></h6>
                        </div>
                        <div class="row justify-content-center d-flex">
                            <label class="text-center mb-4" style="font-size:15px;">Show Actual Path(s)<input
                                    type="checkbox" class="m-1" id="SidebarActualShow"> </label>
                        </div>
                    </div>
                </div>

                <!-- EMPTY FREIGHT SHIPMENTS-->
                <div class="card text-center mt-1"
                    style="border-color:#c3202f; border-radius:10px; border-width: 3px; width:200px; height:auto; right:12px">
                    <div class="row justify-content-center d-flex">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Empty Shipments</b></h6>
                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent" id="btnToggleEmpty"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>
                    </div>

                    <div id="txtEmptyCard">
                        <div class="d-flex justify-content-center">
                            <input type="file" id="EmptyFreightFile" style="display: none;" accept="csv" required />
                            <button id="EmptyFreightButton" onmouseover="this.style.opacity = '0.6'"
                                onmouseout="this.style.opacity = '1'" class="col-6.5 m-1 px-2">Choose File</button>
                        </div>
                        <div class="row justify-content-center d-flex" style="color:#c3202f">
                            <h6 class="text-center" id="noFileEmpty"><b>No File Chosen</b></h6>
                        </div>
                        <div class="row justify-content-center d-flex">

                            <label class="text-center mb-4">Show Empty Freight Path(s)<input type="checkbox" class="m-1"
                                    id="SidebarEmptyShow"> </label>

                        </div>
                    </div>

                </div>

                <!-- MAP SETTINGS || SHIPMENT INFORMATION-->
                <div class="card mt-1"
                    style="border-color:#c3202f; border-radius:10px; border-width:3px; width:200px; height:auto; right:12px">
                    <div class="row justify-content-center d-flex dropdown">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Map Settings</b></h6>
                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent" id="btnToggleInfo"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>

                        <div class="ml-4" id="txtShipmentInfoCard">
                            <h6 class="text-center mr-3"><b>Shipment Location</b></h6>
                            <div id="OriginButtonTag">
                                <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                    class="col-10 btn btn-secondary dropdown-toggle m-2" id="FilterOrg"
                                    style="border-color:#c3202f; background-color: #333333; border-radius:18px ; border-width: 2px; color:white"
                                    type="button" data-toggle="dropdown"><b>Origin</b></button>
                                <div class="dropdown-menu" aria-labelledby="FilterOrg" id="originDropdown">
                                    <input type="text" class="form-control search-input" placeholder="Search...">
                                    <!-- Origin dropdown menu items will be dynamically populated here -->
                                </div>
                            </div>
                            <div id="DestinationButtonTag">
                                <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                    class="col-10 btn btn-secondary dropdown-toggle m-2" id="FilterDes"
                                    style="border-color:#c3202f; background-color: #333333; border-radius:18px ; border-width: 2px; color:white"
                                    type="button" data-toggle="dropdown"><b>Destination</b></button>

                                <div class="dropdown-menu" aria-labelledby="FilterDes" id="destinationDropdown">
                                    <input type="text" class="form-control search-input" placeholder="Search...">
                                    <!-- Destination dropdown menu items will be dynamically populated here -->
                                </div>
                            </div>
                            <div id="ShipmentDateInformation">
                                <h6 class="text-center mt-2 mr-3"><b>Shipment Date</b></h6>
                                <div id="fromShipment">
                                    <input type="text" id="fromShipmentDATE" placeholder="From Date" />
                                </div>
                                <div id="toShipment">
                                    <input type="text" id="toShipmentDATE" placeholder="To Date" />
                                </div>
                            </div>

                            <div class="container d-flex justify-content-between m-2 mb-2">

                                <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                    class="col-8" type="button" id="Apply"
                                    style="border-color: black; background-color:#1867c0; border-radius: 20px; color:white">Apply</button>
                                <!-- <h4 onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'" class="mx-auto mt-2 pr-3"><i class="fa-solid fa-gear"></i></h6> -->
                                <button type="settings" class="fa-solid fa-gear" data-toggle="modal"
                                    data-target="#gearSettings"
                                    style="position: absolute; right: 11%; top: 92%; background-color: transparent; border: transparent; transform: scale(1.5);"></button>
                                <div class="modal fade" id="gearSettings" tabindex="-1" role="dialog"
                                    aria-labelledby="gearSettingsCenterTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="gearSettingsTitle">Map Settings</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="row justify-content-center d-flex">
                                                <label class="text-center mb-2" style="font-size:15px;">Show Freight
                                                    Numbers<input type="checkbox" class="m-1"
                                                        id="MapSetActualFreightShow" checked> </label>
                                            </div>
                                            <div class="row justify-content-center d-flex">
                                                <label class="text-center mb-2" style="font-size:15px;">Show Empties
                                                    Numbers<input type="checkbox" class="m-1" id="MapSetEmptiesShow"
                                                        checked> </label>
                                            </div>
                                            <div class="modal-body">
                                                <h6 style="text-align: center;">FUTURE IMPLEMENTATION</h6>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-primary"
                                                    data-dismiss="modal">Apply</button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>


                        <div class="d-flex justify-content-center d-flex">



                        </div>
                    </div>


                </div>
                <!-- EXPORT-->
                <div class="card mt-1"
                    style="border-color:#c3202f; border-radius:10px; border-width:3px; width:200px; height:auto; right:12px">
                    <div class="row justify-content-center d-flex">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Export to PDF</b></h6>

                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent" id="btnToggleExport"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>
                    </div>
                    <div class="ml-4 " id="txtShipmentExportCard">
                        <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                            class="col-7 p-2 ml-4 bg-success" type="button" id="btnExport"
                            style="border-color: black; border-radius: 20px; color:white">Export &nbsp<i
                                class="fa-solid fa-right-from-bracket"></i></button>
                        <label class="text-center mx-3 mb-4" style="font-size:15px">Add Logo to PDF<input
                                type="checkbox" class="m-1">
                        </label>
                    </div>
                </div>

                <!-- PATH CONFLICTS-->
                <div id="pathConflictsBox" class="card mt-1"
                    style="border-color:#c3202f; border-radius:10px ; border-width:2px; width: 200px; right:12px">
                    <div class="row justify-content-center d-flex">
                        <div class="container d-flex justify-content-between m-2 mb-2">
                            <h6 class="text-center mt-2 ml-5"><b>Path Conflicts</b></h6>

                            <button onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                                class="col-3 rotate bg-transparent" id="btnTogglePath"
                                style="border-width: 0px; background-color: white;"><i
                                    class="fa-solid fa-angle-up"></i></button>
                        </div>
                    </div>
                    <div class="text-left  " id="txtPathCard">
                        <p id="txtPathConflicts"></p>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <div>
        <button type="button" id="clear-map" onclick="clearingPolylines()"><b>Clear Map</b></button>
    </div>

    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css'
        rel='stylesheet' />

    <!-- Map Suite Test Placement -->
    <div class="card" style="position: relative; block-size: fit-content; border: 1px; border-color: #333333">

        <div id="map">
            <div id="navBarButton">
                <button id="btnCollapseNav"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>

        <script>
            var map = L.map('map', { zoomControl: false }).setView([34.5, -86], 6);

            var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 8,
                minZoom: 4,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            L.control.zoom({
                position: 'topright'
            }).addTo(map);

            L.control.fullscreen({
                position: 'topright',
                forceSeparateButton: false,
                forcPseudoFullscreen: true
            }).addTo(map);

            //add ocean image as background
            var ocean = new L.tileLayer("images/ocean.png", {
                maxZoom: 8,
                minZoom: 4,
            }).addTo(map);

            function style(feature) {
                return {
                    fillColor: '#E6E6E3',
                    weight: 1,
                    opacity: 1,
                    color: '#333333',
                    dashArray: '3',
                    fillOpacity: 1
                };
            }

            var blueIcon = new L.Icon({
                iconUrl: 'images/blue-circle.png',
                iconSize: [31.8, 31.8],
                iconAnchor: [16.5, 16],
                popupAnchor: [0, 0],
            });

            // Add the US states layer to the map
            L.geoJson(statesData, { style: style }).addTo(map);

        </script>
    </div>

    <footer class="page-footer"
        style="background-color:#333333; width:100%; margin: 0; border-style: solid none none none;">
        <div class="container mt-5 pt-2" style="float: left;">
            <img src="images/Averitt_logo_white.gif" class="float-left col-4 mt-2" alt="AverittLogoFooter" />
        </div>
        <div class="vcard" style="text-align: right; color:white; margin-right: 30%; margin-top: 4%;">
            <span class="fn org" style="font-size: 20px;">Averitt Express</span>
            <div class="addr" style="font-size: 12px">
                <span class="street">1415 Neal Street P.O. Box 3166<br></span>
                <span class="city">Cookeville,</span>
                <span class="state">TN</span>
                <span class="postal">38502</span>
            </div>
            <div class="copyright" style="font-size: 12px;"><br>© 2023 Averitt Express. All rights reserved.</div>
        </div>
        <!-- <div class="float-right justify-content-right m-4">
            <hr class="flex" style="color:white; background-color: white;">
            <h6 class="text-white text-right">Averitt Express</h5>
                <h6 class="text-white text-right">1415 Neal Street P.O Box 3166</h5>
                    <h6 class="text-white text-right">Cookeville, TN 38502</h5>
                        <h6></h6>
                        <h7 class="text-white">2022 Averitt Express, All Rights Reserved.</h7>
        </div> -->
    </footer>

    <div id="my-popup" class="popup" style.display="block">
        <div class="popup-content">
            <h5 id="popup-message">Please Import The Service Center File</h5>
            <input type="file" id="ServiceFile" style="display: none;" accept="csv" required />
            <button id="ServiceButton" onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                class="col-6.5 m-1 px-2">Choose File</button>
            <div class="row justify-content-center d-flex" style="color:#c3202f">
                <h6 class="text-center" id="noFileService"><b>No File Chosen</b></h6>
            </div>
            <input type="file" id="ServiceFile" style="display: none;" accept="csv" required />
            <div>
                <button id="cancelButton" onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                    class="col-6.5 m-1 px-2">Cancel</button>
                <button id="okButton" onmouseover="this.style.opacity = '0.6'" onmouseout="this.style.opacity = '1'"
                    class="col-6.5 m-1 px-2">Submit</button>
            </div>
            <p id="contactSupport" class="mt-2" style="color:#c3202f; font-size: 10px">Please contact tech@averitt.com
                for technical issues/questions</p>
        </div>

        <div id="error-popup" class="popup" style.display="none">
            <div class="popup-content">
                <p id="epopup-message">Error. Please contact tech@averitt.com</p>
                <button id="popup-close">Close</button>
            </div>
        </div>





        <!-- CDNs AND SCRIPTS -->
        <script src="js/lib/jquery-3.6.1.min.js"></script>
        <script src="js/lib/bootstrap.bundle.min.js"></script>
        <script src="js/lib/sweetalert2@11.js"></script>
        <script src="https://kit.fontawesome.com/1612810c5a.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
        <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
        <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js"></script>
        <script src="js/lib/printThis.js"></script>
        <script src="dist/leaflet.print-src.js"></script>
        <script src="dist/leaflet.print.js"></script>
        <script>
            var polylinesList = [];
            var polylinesArrowList = [];
            const closeButton = document.querySelector('#cancelButton');
            const ecloseButton = document.querySelector('#error-popup');
            const submitButton = document.querySelector('#okButton');
            submitButton.disabled = true;
            submitButton.classList.add('grayed-out');
            const popup = document.querySelector('#my-popup');
            const epopup = document.querySelector('#error-popup');
            const popupMessage = document.querySelector('#popup-content');
            const epopupMessage = document.querySelector('#error-popup');

            popup.style.display = "block";

            let SVCArr;
            let ActualArr;
            let SCHEDArr;
            let EMPTYArr;

            const ServiceFile = document.getElementById("ServiceFile");
            const ServiceButton = document.getElementById("ServiceButton");

            ServiceButton.onclick = function () {
                ServiceFile.click();
            };


            ServiceFile.onchange = function () {
                const file = ServiceFile.files[0];

                const filename = $('#ServiceFile').val().split('\\').pop();

                $('#noFileService').text("");

                $('#noFileService').append(filename);

                if (filename == "error.csv") {
                    epopup.style.display = 'block';
                }

                const reader = new FileReader();

                reader.onload = function (e) {
                    const text = e.target.result;
                    SVCArr = SVCcsvToArray(text);
                    getsvcfiledata(SVCArr);
                    populateDropdowns(SVCArr, orgDropdownMenu, orgBtn);
                    populateDropdowns(SVCArr, desDropdownMenu, desBtn);
                };

                reader.readAsText(file);

                function SVCcsvToArray(str, delimiter = ",") {
                    const headers = ["INDEX", "ABBR", "NAME", "ID", "LAT", "LON"];
                    const rows = str.split("\n");
                    const arr = rows.map(function (row) {
                        const values = row.replace("\r", "").split(delimiter);
                        const el = headers.reduce(function (object, header, index) {
                            object[header] = values[index];
                            return object;
                        }, {});
                        return el;
                    });
                    console.log(arr);
                    return arr;
                }
                submitButton.disabled = false;
                submitButton.classList.remove('grayed-out');
                submitButton.classList.add('green');
            };

            // Function to filter and display data based on the selected filter options
            function displayData() {
                document.getElementById("txtPathConflicts").innerHTML = "";
                const selectedOrg = orgBtn.textContent;
                const selectedDes = desBtn.textContent;
                const fromDateString = document.getElementById("fromShipmentDATE").value;
                const toDateString = document.getElementById("toShipmentDATE").value;
                const fromDate = new Date(fromDateString);
                const toDate = new Date(toDateString);
                if (selectedOrg === "ALL" && selectedDes === "ALL") {
                    // Display all data
                    console.log(SCHEDArr);
                    console.log(ActualArr);
                    console.log(EMPTYArr);
                    if (scheduledPathShown && SCHEDArr) {
                        getSCHEDfiledata(SCHEDArr, SVCArr);
                    }
                    if (actualPathShown && ActualArr) {
                        getActualfiledata(ActualArr, SVCArr);
                    }
                    if (emptyPathShown && EMPTYArr) {
                        getEmptyfiledata(EMPTYArr, SVCArr);
                    }
                    if (scheduledPathShown && actualPathShown && SCHEDArr && ActualArr) {
                        console.log(PathConflicts(ActualArr, SCHEDArr));
                        conflicts = PathConflicts(ActualArr, SCHEDArr);

                        for (let i = 0; i < conflicts.length; i++) {
                            for (let j = 0; j < 4; j++) {
                                $('#txtPathConflicts').append(conflicts[i][j])
                                $('#txtPathConflicts').append('<br/>')
                            }

                            $('#txtPathConflicts').append('<br/>')
                        }


                    }
                } else if (selectedOrg === "ALL" && selectedDes !== "ALL") {
                    // Display data for selected destination
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };

                    if (scheduledPathShown && SCHEDArr) {
                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }

                    if (actualPathShown && ActualArr) {

                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (emptyPathShown && EMPTYArr) {

                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes) {
                                data.EMPTY.push(row);
                            }
                        });
                    }
                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }

                    if (scheduledPathShown && actualPathShown && SCHEDArr && ActualArr) {
                        console.log(PathConflicts(data.Actual, data.SCHED));
                        conflicts = PathConflicts(data.Actual, data.SCHED);

                        for (let i = 0; i < conflicts.length; i++) {
                            for (let j = 0; j < 4; j++) {
                                $('#txtPathConflicts').append(conflicts[i][j])
                                $('#txtPathConflicts').append('<br/>')
                            }

                            $('#txtPathConflicts').append('<br/>')
                        }
                    }
                } else if (selectedOrg !== "ALL" && selectedDes === "ALL") {
                    // Display data for selected origin
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };
                    if (scheduledPathShown && SCHEDArr) {
                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }
                    if (actualPathShown && ActualArr) {

                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (emptyPathShown && EMPTYArr) {

                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg) {
                                data.EMPTY.push(row);
                            }
                        });
                    }
                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }

                    if (scheduledPathShown && actualPathShown && SCHEDArr && ActualArr) {
                        console.log(PathConflicts(data.Actual, data.SCHED));
                        conflicts = PathConflicts(data.Actual, data.SCHED);

                        for (let i = 0; i < conflicts.length; i++) {
                            for (let j = 0; j < 4; j++) {
                                $('#txtPathConflicts').append(conflicts[i][j])
                                $('#txtPathConflicts').append('<br/>')
                            }

                            $('#txtPathConflicts').append('<br/>')
                        }
                    }
                } else if (selectedOrg !== "ALL" && selectedDes !== "ALL") {
                    // Display data for selected origin and destination
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };
                    if (scheduledPathShown && SCHEDArr) {

                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }
                    if (actualPathShown && ActualArr) {
                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (emptyPathShown && EMPTYArr) {
                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION == selectedDes) {
                                data.EMPTY.push(row);
                            }
                        });
                    }

                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }
                    if (scheduledPathShown && actualPathShown && SCHEDArr && ActualArr) {
                        console.log(PathConflicts(data.Actual, data.SCHED));
                        conflicts = PathConflicts(data.Actual, data.SCHED);

                        for (let i = 0; i < conflicts.length; i++) {
                            for (let j = 0; j < 4; j++) {
                                $('#txtPathConflicts').append(conflicts[i][j])
                                $('#txtPathConflicts').append('<br/>')
                            }

                            $('#txtPathConflicts').append('<br/>')
                        }
                    }
                } else if (selectedOrg === selectedDes) {
                    // Error case for same origin and destination
                    console.log("Error: Origin and destination cannot be the same.");
                }
            }
            /*
            function displayData() {
                const selectedOrg = orgBtn.textContent;
                const selectedDes = desBtn.textContent;
                const fromDateString = document.getElementById("fromShipmentDATE").value;
                const toDateString = document.getElementById("toShipmentDATE").value;
                const fromDate = new Date(fromDateString);
                const toDate = new Date(toDateString);
                if (selectedOrg === "ALL" && selectedDes === "ALL") {
                    // Display all data
                    console.log(SCHEDArr);
                    console.log(ActualArr);
                    console.log(EMPTYArr);
                    if (SCHEDArr) {
                        getSCHEDfiledata(SCHEDArr, SVCArr);
                    }
                    if (ActualArr) {
                        getActualfiledata(ActualArr, SVCArr);
                    }
                    if (EMPTYArr) {
                        getEmptyfiledata(EMPTYArr, SVCArr);
                    }
                } else if (selectedOrg === "ALL" && selectedDes !== "ALL") {
                    // Display data for selected destination
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };
    
                    if (SCHEDArr) {
                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }
    
                    if (ActualArr) {
    
                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (EMPTYArr) {
    
                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.EMPTY.push(row);
                            }
                        });
                    }
                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }
                } else if (selectedOrg !== "ALL" && selectedDes === "ALL") {
                    // Display data for selected origin
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };
                    if (SCHEDArr) {
                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }
                    if (ActualArr) {
    
                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (EMPTYArr) {
    
                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && rowDate >= fromDate && rowDate <= toDate) {
                                data.EMPTY.push(row);
                            }
                        });
                    }
                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }
                } else if (selectedOrg !== "ALL" && selectedDes !== "ALL") {
                    // Display data for selected origin and destination
                    const data = {
                        SCHED: [],
                        Actual: [],
                        EMPTY: []
                    };
                    if (SCHEDArr) {
    
                        SCHEDArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.SCHED.push(row);
                            }
                        });
                    }
                    if (ActualArr) {
                        ActualArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.Actual.push(row);
                            }
                        });
                    }
                    if (EMPTYArr) {
                        EMPTYArr.forEach((row) => {
                            const rowDate = new Date(row.DATE);
                            if (row.ORIGIN === selectedOrg && row.DESTINATION === selectedDes && rowDate >= fromDate && rowDate <= toDate) {
                                data.EMPTY.push(row);
                            }
                        });
                    }
    
                    console.log(data.SCHED);
                    console.log(data.Actual);
                    console.log(data.EMPTY);
                    if (data.SCHED) {
                        getSCHEDfiledata(data.SCHED, SVCArr);
                    }
                    if (data.Actual) {
                        getActualfiledata(data.Actual, SVCArr);
                    }
                    if (data.EMPTY) {
                        getEmptyfiledata(data.EMPTY, SVCArr);
                    }
                } else if (selectedOrg === selectedDes) {
                    // Error case for same origin and destination
                    console.log("Error: Origin and destination cannot be the same.");
                }
            }*/
            // Get the buttons
            const orgBtn = document.getElementById("FilterOrg");
            const desBtn = document.getElementById("FilterDes");

            // Get the dropdown menu
            const orgDropdownMenu = document.getElementById("originDropdown");
            const desDropdownMenu = document.getElementById("destinationDropdown");

            // Function to create dropdown items
            function createDropdownItem(text) {
                const dropdownItem = document.createElement("a");
                dropdownItem.classList.add("dropdown-item");
                dropdownItem.setAttribute("href", "#");
                dropdownItem.textContent = text;
                return dropdownItem;
            }

            // Populate the origin and destination dropdowns
            function populateDropdowns(arr, dropdownMenu, targetButton) {
                const uniqueValues = new Set(arr.map(item => item.ABBR));
                const sortedValues = ["ALL", ...Array.from(uniqueValues).sort()]; // Add "ALL" to the beginning of the sortedValues array
                sortedValues.forEach((value) => {
                    const dropdownItem = createDropdownItem(value);
                    if (targetButton === orgBtn) {
                        dropdownItem.addEventListener("click", () => {
                            orgBtn.textContent = value;
                        });
                        dropdownMenu.appendChild(dropdownItem);
                    } else if (targetButton === desBtn) {
                        dropdownItem.addEventListener("click", () => {
                            desBtn.textContent = value;
                        });
                        dropdownMenu.appendChild(dropdownItem);
                    }
                });
                const searchInput = dropdownMenu.querySelector('.search-input');
                searchInput.addEventListener('input', () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    dropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
                        if (item.textContent.toLowerCase().includes(searchTerm)) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }


            //let ActualArr;
            const ActualFile = document.getElementById("ActualPathFile");
            const ActualButton = document.getElementById("ActualPathButton");

            ActualButton.onclick = function () {
                ActualFile.click();
            };
            var filename = $('#ActualPathFile').val().split('\\').pop();
            ActualFile.onchange = function () {
                const file = ActualFile.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const text = e.target.result;
                    ActualArr = ActaulcsvToArray(text);
                    //getActualfiledata(ActualArr, SVCArr);
                };
                filename = $('#ActualPathFile').val().split('\\').pop();

                $('#noFileActual').text("");

                $('#noFileActual').append(filename);

                if (filename == "error.csv") {
                    epopup.style.display = 'block'
                }
                reader.readAsText(file);

                function ActaulcsvToArray(str, delimiter = ",") {
                    const headers = ["DATE", "ORIGIN", "DESTINATION", "PATH", "NUMFREIGHTS"];
                    const rows = str.split("\n");
                    arr = rows.map(function (row, index) { // Add 'index' as a second parameter to the map function
                        const values = row.replace("\r", "").split(delimiter);
                        const pathLocations = values[3].split('-');
                        const locations = pathLocations.map(loc => {
                            const location = SVCArr.find(service => service.ABBR === loc);
                            if (!location) {
                                console.log(`Could not find location for path index ${index} location: `, loc); // Add this console.log statement
                            }
                            return location;
                        });
                        if (locations.some(loc => !loc)) {
                            return null;
                        }
                        const el = headers.reduce(function (object, header, index) {
                            if (header === "PATH") {
                                object[header] = locations;
                            } else {
                                object[header] = values[index];
                            }
                            return object;
                        }, {});
                        return el;
                    }).filter(Boolean);
                    console.log(arr);
                    return arr;
                }
            };








            //let SCHEDArr;
            const ScheduledFile = document.getElementById("ScheduledPathFile");
            const ScheduledButton = document.getElementById("ScheduledPathButton");

            ScheduledButton.onclick = function () {
                ScheduledFile.click();
            };
            var filename = $('#ScheduledPathFile').val().split('\\').pop();
            ScheduledFile.onchange = function () {
                const file = ScheduledFile.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const text = e.target.result;
                    SCHEDArr = SCHEDcsvToArray(text);
                    //getSCHEDfiledata(SCHEDArr, SVCArr);
                };

                filename = $('#ScheduledPathFile').val().split('\\').pop();

                $('#noFileScheduled').text("");

                $('#noFileScheduled').append(filename);

                if (filename == "error.csv") {
                    epopup.style.display = 'block'
                }


                reader.readAsText(file);

                function SCHEDcsvToArray(str, delimiter = ",") {
                    const headers = ["DATE", "ORIGIN", "DESTINATION", "PATH"];
                    const rows = str.split("\n");
                    arr = rows.map(function (row, index) { // Add 'index' as a second parameter to the map function
                        const values = row.replace("\r", "").split(delimiter);
                        const pathLocations = values[3].split('-');
                        const locations = pathLocations.map(loc => {
                            const location = SVCArr.find(service => service.ABBR === loc);
                            if (!location) {
                                console.log(`Could not find location for path index ${index} location: `, loc); // Add this console.log statement
                            }
                            return location;
                        });
                        if (locations.some(loc => !loc)) {
                            return null;
                        }
                        const el = headers.reduce(function (object, header, index) {
                            if (header === "PATH") {
                                object[header] = locations;
                            } else {
                                object[header] = values[index];
                            }
                            return object;
                        }, {});
                        return el;
                    }).filter(Boolean);
                    console.log(arr);
                    return arr;
                }
            };


            //let EMPTYArr;
            const EmptyFreightFile = document.getElementById("EmptyFreightFile");
            const EmptyFreightButton = document.getElementById("EmptyFreightButton");

            EmptyFreightButton.onclick = function () {
                EmptyFreightFile.click();
            };

            EmptyFreightFile.onchange = function () {
                const file = EmptyFreightFile.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const text = e.target.result;
                    EMPTYArr = EmptycsvToArray(text);
                    //getEmptyfiledata(EMPTYArr, SVCArr);
                };

                const filename = $('#EmptyFreightFile').val().split('\\').pop();

                $('#noFileEmpty').text("");
                $('#noFileEmpty').append(filename);

                if (filename == "error.csv") {
                    epopup.style.display = 'block';
                }

                reader.readAsText(file);

                function EmptycsvToArray(str, delimiter = ",") {
                    const headers = ["ORIGIN", "DESTINATION", "Empties"];
                    const rows = str.split("\n");
                    const arr = rows.map(function (row) {
                        const values = row.replace("\r", "").split(delimiter);
                        const el = headers.reduce(function (object, header, index) {
                            if (header === "ORIGIN" || header === "DESTINATION" || header === "Empties") {
                                object[header] = values[index];
                            }
                            return object;
                        }, {});
                        return el;
                    }).filter(Boolean);
                    console.log(arr);
                    return arr;
                }
            };

            let actualPathShown = false;
            let scheduledPathShown = false;
            let emptyPathShown = false;
            const applyButton = document.getElementById('Apply');
            applyButton.addEventListener('click', runFiles);
            document.getElementById('SidebarActualShow').addEventListener('change', function () {
                actualPathShown = this.checked;
            });
            document.getElementById('SidebarScheduledShow').addEventListener('change', function () {
                scheduledPathShown = this.checked;
            });
            document.getElementById('SidebarEmptyShow').addEventListener('change', function () {
                emptyPathShown = this.checked;
            });
            function runFiles() {

                // if (SCHEDArr && ActualArr) {
                //     console.log(PathConflicts(ActualArr, SCHEDArr));
                //     conflicts = PathConflicts(ActualArr, SCHEDArr);

                //     for (let i = 0; i < conflicts.length; i++) {
                //         for (let j = 0; j < 2; j++) {
                //             $('#txtPathConflicts').append(conflicts[i][j])
                //             $('#txtPathConflicts').append('<br/>')
                //         }

                //         $('#txtPathConflicts').append('<br/>')
                //     }
                // }
                if (scheduledPathShown) {
                    if (SCHEDArr) {
                        displayData();
                    }
                }
                else if (actualPathShown) {
                    if (ActualArr) {
                        displayData();
                    }
                }

                else if (emptyPathShown) {
                    if (EMPTYArr) {
                        displayData();
                    }
                }
                // if (scheduledPathShown) {
                //     if (SCHEDArr) {
                //         getSCHEDfiledata(SCHEDArr, SVCArr);
                //     }
                // }
                // if (actualPathShown) {
                //     if (ActualArr) {
                //         getActualfiledata(ActualArr, SVCArr);
                //     }
                // }
                // if (emptyPathShown) {
                //     if (EMPTYArr) {
                //         getEmptyfiledata(EMPTYArr, SVCArr);
                //     }
                // }
            }



            function getsvcfiledata(SVCArr) {
                for (let i = 0; i < SVCArr.length; i++) {
                    var latitude = SVCArr[i].LAT;
                    var longitude = SVCArr[i].LON;
                    const marker = L.marker([latitude, longitude], { title: SVCArr[i].NAME, icon: blueIcon }).addTo(map);
                    marker.bindTooltip(SVCArr[i].ABBR, {
                        permanent: true,
                        direction: 'center',
                        className: "m-labels"
                    });
                }
                // Creates a legend for Leaflet Map 
                const legend = L.control({ position: "bottomright" });
                legend.onAdd = function (map) {
                    const div = L.DomUtil.create("div", "legend");
                    div.innerHTML += "<h5 class><b>Legend</b></h5>";
                    div.innerHTML += '<div><span class="legend-box scheduled"></span><span class="legend-text"><b>Scheduled Path</b></span></div>';
                    div.innerHTML += '<div><span class="legend-box actual"></span><span class="legend-text"><b>Actual Path</b></span></div>';
                    div.innerHTML += '<div><span class="legend-box empty"></span><span class="legend-text"><b>Empty Freight Path</b></span></div>';
                    div.innerHTML += '<div><span class="legend-box combined"></span><span class="legend-text"><b>Scheduled/Actual Path</b></span></div>';
                    div.style.width = "175px";
                    div.style.height = "130px";
                    div.style.background = "rgba(255, 255, 255, 0.85)";
                    div.style.border = "2px solid #c3202f";
                    div.style.color = "black";
                    div.style.textAlign = "center";
                    div.style.borderRadius = "10px";
                    return div;
                };
                legend.addTo(map);
            }


            function getSCHEDfiledata(SCHED, SERVICE) {
                const CenterCoords = {};
                for (let i = 0; i < SERVICE.length; i++) {
                    CenterCoords[SERVICE[i].ABBR] = { lat: SERVICE[i].LAT, lng: SERVICE[i].LON };
                }
                for (let i = 0; i < SCHED.length; i++) {
                    const abbrs = SCHED[i].PATH.map(location => location.ABBR);
                    if (!abbrs) {
                        console.log(`Invalid PATH for index ${i}`);
                        continue;
                    }
                    const locations = abbrs.map(abbr => CenterCoords[abbr]);
                    const hasUndefinedLocations = locations.some(loc => !loc);
                    if (hasUndefinedLocations) {
                        console.log("Could not find locations for path: ", abbrs);
                        continue;
                    }
                    const arrLocations = locations.map(loc => [loc.lat, loc.lng]);
                    const polyline = L.polyline(arrLocations, {
                        color: 'blue',
                        weight: 3,
                        opacity: 0.8,
                        interactive: true,
                        dashArray: '5, 8, 2, 8',
                    }).addTo(map);
                    polylinesList.push(polyline);

                    const arrowHead = L.polylineDecorator(polyline, {
                        patterns: [
                            {
                                offset: '97%',
                                repeat: 0,
                                symbol: L.Symbol.arrowHead({
                                    pixelSize: 15,
                                    polygon: false,
                                    pathOptions: {
                                        stroke: true,
                                        color: 'blue',
                                        weight: 3
                                    }
                                })
                            }
                        ],
                        patternOptions: {
                            offset: '100%',
                        }
                    }).addTo(map);

                    polylinesArrowList.push(arrowHead);
                }

            }


            function getActualfiledata(ACTUAL, SERVICE) {
                const CenterCoords = {};
                const actualCheckbox = document.getElementById("MapSetActualFreightShow");
                for (let i = 0; i < SERVICE.length; i++) {
                    CenterCoords[SERVICE[i].ABBR] = { lat: SERVICE[i].LAT, lng: SERVICE[i].LON };
                }
                for (let i = 0; i < ACTUAL.length; i++) {
                    const abbrs = ACTUAL[i].PATH.map(location => location.ABBR);
                    if (!abbrs) {
                        console.log(`Invalid PATH for index ${i}`);
                        continue;
                    }
                    const locations = abbrs.map(abbr => CenterCoords[abbr]);
                    const hasUndefinedLocations = locations.some(loc => !loc);
                    if (hasUndefinedLocations) {
                        console.log("Could not find locations for path: ", abbrs);
                        continue;
                    }
                    const arrLocations = locations.map(loc => [loc.lat, loc.lng]);
                    const polyline = L.polyline(arrLocations, { color: 'red', weight: 2, dashArray: '5, 8, 2, 8', dashOffset: '5', dashOffset: '5', opacity: 0.8, interactive: true }).bindTooltip(ActualArr[i].NUMFREIGHTS, { direction: 'center', permanent: true, className: "Act-numlabel" }).addTo(map);

                    polylinesList.push(polyline);

                    const arrowHead = L.polylineDecorator(polyline, {
                        patterns: [
                            {
                                offset: '97%',
                                repeat: 0,
                                symbol: L.Symbol.arrowHead({
                                    pixelSize: 15,
                                    polygon: false,
                                    pathOptions: {
                                        stroke: true,
                                        color: 'red',
                                        weight: 2
                                    }
                                })
                            }
                        ],
                        patternOptions: {
                            offset: '100%',
                        }
                    }).addTo(map);

                    polylinesArrowList.push(arrowHead);
                }
                actualCheckbox.addEventListener("change", function () {
                    for (let i = 0; i < ActualArr.length; i++) {
                        const tooltip = polylinesList[i].getTooltip();
                        if (this.checked) {
                            tooltip.addTo(map);
                        } else {
                            if (!polylinesList[i].options.color.includes("green")) {
                                tooltip.remove();
                            }
                        }
                    }
                });
            }

            function getEmptyfiledata(EMPTY, SERVICE) {
                const emptyCheckbox = document.getElementById("MapSetEmptiesShow")
                const CenterCoords = {};
                for (let i = 0; i < SERVICE.length; i++) {
                    CenterCoords[SERVICE[i].ABBR] = { lat: SERVICE[i].LAT, lng: SERVICE[i].LON };
                }
                for (let i = 0; i < EMPTY.length; i++) {
                    const abbrs = [EMPTY[i].ORIGIN, EMPTY[i].DESTINATION];
                    if (!abbrs) {
                        console.log(`Invalid PATH for index ${i}`);
                        continue;
                    }
                    const locations = abbrs.map(abbr => CenterCoords[abbr]);
                    const hasUndefinedLocations = locations.some(loc => !loc);
                    if (hasUndefinedLocations) {
                        console.log("Could not find locations for path: ", abbrs);
                        continue;
                    }
                    const arrLocations = locations.map(loc => [loc.lat, loc.lng]);
                    const polyline = L.polyline(arrLocations, { color: 'green', weight: 2, opacity: 0.8, interactive: true }).bindTooltip(EMPTYArr[i].Empties, { direction: 'center', permanent: true, className: "Act-numlabel" }).addTo(map);

                    polylinesList.push(polyline);

                    const arrowHead = L.polylineDecorator(polyline, {
                        patterns: [
                            {
                                offset: '97%',
                                repeat: 0,
                                symbol: L.Symbol.arrowHead({
                                    pixelSize: 15,
                                    polygon: false,
                                    pathOptions: {
                                        stroke: true,
                                        color: 'green',
                                        weight: 3
                                    }
                                })
                            }
                        ],
                        patternOptions: {
                            offset: '100%',
                        }
                    }).addTo(map);

                    polylinesArrowList.push(arrowHead);
                }
                emptyCheckbox.addEventListener("change", function () {
                    for (let i = 0; i < EMPTYArr.length; i++) {
                        const tooltip = polylinesList[i].getTooltip();
                        if (this.checked) {
                            tooltip.addTo(map);
                        } else {
                            tooltip.remove();
                        }
                    }
                });
            }

            function PathConflicts(ActualArr, SCHEDArr) {

                const conflicts = [];
                let noConflict = false;
                let actualArrStr = "";
                let schedArrStr = "";
                let dateStr = "";
                let countStr = "";

                for (let i = 0; i < ActualArr.length; i++) {

                    actualArrStr = ""
                    schedArrStr = ""
                    dateStr = "";
                    countStr = "";

                    scheduled = [];
                    for (let j = 0; j < SCHEDArr.length; j++) {
                        if (SCHEDArr[j].DATE == ActualArr[i].DATE && SCHEDArr[j].ORIGIN == ActualArr[i].ORIGIN && SCHEDArr[j].DESTINATION == ActualArr[i].DESTINATION) {
                            if (SCHEDArr[j].PATH.length != ActualArr[i].PATH.length) {
                                noConflict = false;
                                scheduled = SCHEDArr[j].PATH;
                                break;
                            } else {
                                for (let k = 0; k < SCHEDArr[j].PATH.length; k++) {
                                    if (ActualArr[i].PATH[k] != SCHEDArr[j].PATH[k]) {
                                        noConflict = false;
                                        scheduled = SCHEDArr[j].PATH;
                                        break;
                                    }
                                }
                            }

                            noConflict = true;
                            break;
                        }
                    }

                    if (noConflict == false) {

                        actualArrStr = actualArrStr.concat("<b>Actual: </b>")

                        for (let k = 0; k < ActualArr[i].PATH.length; k++) {
                            actualArrStr = actualArrStr.concat(ActualArr[i].PATH[k].ABBR);
                            if (k != ActualArr[i].PATH.length - 1) {
                                actualArrStr = actualArrStr.concat("-");
                            }
                        }

                        schedArrStr = schedArrStr.concat("<b>Scheduled: </b>")

                        for (let k = 0; k < scheduled.length; k++) {
                            schedArrStr = schedArrStr.concat(scheduled[k].ABBR);
                            if (k != scheduled[k].length - 1) {
                                schedArrStr = schedArrStr.concat("-");
                            }
                        }

                        dateStr = dateStr.concat("<b>Date: </b>");
                        dateStr = dateStr.concat(ActualArr[i].DATE);

                        countStr = countStr.concat("<b>Freight Count: </b>")
                        countStr = countStr.concat(ActualArr[i].NUMFREIGHTS)


                        conflicts.push([actualArrStr, schedArrStr.slice(0, -1), dateStr, countStr])
                    }
                }

                return conflicts;



            }


            /*
            function PathConflicts(ActualArr, SCHEDArr) {
    
                const conflicts = [];
                let noConflict = false;
                let actualArrStr = "";
                let schedArrStr = "";
                let dateStr = "";
    
                for (let i = 0; i < ActualArr.length; i++) {
    
                    actualArrStr = ""
                    schedArrStr = ""
                    dateStr = "";
    
                    scheduled = [];
                    for (let j = 0; j < SCHEDArr.length; j++) {
                        if (SCHEDArr[j].DATE == ActualArr[i].DATE && SCHEDArr[j].ORIGIN == ActualArr[i].ORIGIN && SCHEDArr[j].DESTINATION == ActualArr[i].DESTINATION) {
                            if (SCHEDArr[j].PATH.length != ActualArr[i].PATH.length) {
                                noConflict = false;
                                scheduled = SCHEDArr[j].PATH;
                                break;
                            } else {
                                for (let k = 0; k < SCHEDArr[j].PATH.length; k++) {
                                    if (ActualArr[i].PATH[k] != SCHEDArr[j].PATH[k]) {
                                        noConflict = false;
                                        scheduled = SCHEDArr[j].PATH;
                                        break;
                                    }
                                }
                            }
    
                            noConflict = true;
                            break;
                        }
                    }
    
                    if (noConflict == false) {
    
                        actualArrStr = actualArrStr.concat("<b>Actual: </b>")
    
                        for (let k = 0; k < ActualArr[i].PATH.length; k++) {
                            actualArrStr = actualArrStr.concat(ActualArr[i].PATH[k].ABBR);
                            if (k != ActualArr[i].PATH.length - 1) {
                                actualArrStr = actualArrStr.concat("-");
                            }
                        }
    
                        schedArrStr = schedArrStr.concat("<b>Scheduled: </b>")
    
                        for (let k = 0; k < scheduled.length; k++) {
                            schedArrStr = schedArrStr.concat(scheduled[k].ABBR);
                            if (k != scheduled[k].length - 1) {
                                schedArrStr = schedArrStr.concat("-");
                            }
                        }
    
                        dateStr = dateStr.concat("<b>Date: </b>");
                        dateStr = dateStr.concat(ActualArr[i].DATE);
    
    
                        conflicts.push([actualArrStr, schedArrStr.slice(0, -1), dateStr])
                    }
                }
    
                return conflicts;
    
    
            }
            */

            function clearingPolylines() {
                for (var i = 0; i < polylinesList.length; i++) {
                    map.removeLayer(polylinesList[i]);
                    map.removeLayer(polylinesArrowList[i]);
                }
                polylinesList = [];
                polylinesArrowList = [];
                document.getElementById("txtPathConflicts").innerHTML = "";
            }
        </script>



        <script>
        //Apply button
        //Create Array


        </script>

        <script>
            $('#btnToggleScheduled').on('click', function () {

                $('#txtSchedCard').slideToggle();
                // $('#btnToggleScheduled').addClass('rotating')
                // $("#txtSchedCard").animate({width:'toggle'},350);

            })
        </script>

        <script>
            $('#btnToggleActual').on('click', function () {

                $('#txtActualCard').slideToggle();

            })
        </script>

        <script>
            $('#btnToggleEmpty').on('click', function () {

                $('#txtEmptyCard').slideToggle();

            })
        </script>

        <script>
            $('#btnToggleInfo').on('click', function () {

                $('#txtShipmentInfoCard').slideToggle();

            })
        </script>

        <script>
            $('#btnToggleExport').on('click', function () {

                $('#txtShipmentExportCard').slideToggle();

            })
        </script>

        <script>
            $('#btnTogglePath').on('click', function () {

                $('#txtPathCard').slideToggle();

            })
        </script>

        <script>
            const btnToggleExport = document.getElementById('btnToggleExport');
            const txtShipmentExportCard = document.getElementById('txtShipmentExportCard');

            btnToggleExport.addEventListener('click', function () {
                txtShipmentExportCard.classList.slideToggle('d-none');
                btnToggleExport.querySelector('i').classList.toggle('fa-angle-up');
                btnToggleExport.querySelector('i').classList.toggle('fa-angle-down');
            });
        </script>

        <script>
            $(document).ready(function () {
                $(".slide-toggle").click(function () {
                    $(".box").animate({
                        width: "toggle"
                    });
                    $('#btnCollapseNav').val('');
                    // $('#btnCollapseNav').append('<i class="fa-solid fa-angles-right"></i>')
                });
            });
        </script>
        <script>
            $(".rotate").click(function () {
                $(this).toggleClass("down");
            });
        </script>

        <!-- This script will resize the map when zoomed in/out in a browser -->
        <script>
            var mapmargin = 0;
            $('#map').css("height", ($(window).height() - mapmargin));
            $(window).on("resize", resize);
            resize();
            function resize() {

                if ($(window).width() >= 980) {
                    $('#map').css("height", ($(window).height() - mapmargin));
                    //$('#map').css("margin-top", 50);
                } else {
                    $('#map').css("height", ($(window).height() - (mapmargin)));
                    //$('#map').css("margin-top", -21);
                }
                //setTimeout(function(){ map.invalidateSize(true)}, 300);
                map.invalidateSize();

            }
        </script>

        <script>
            // Add an event listener to the close button that hides the popup
            closeButton.addEventListener('click', () => {
                popup.style.display = 'none';
            });
        </script>

        <script>
            // Add an event listener to the close button that hides the popup
            submitButton.addEventListener('click', () => {
                popup.style.display = 'none';
            });
        </script>

        <script>
            // Add an event listener to the close button that hides the popup
            ecloseButton.addEventListener('click', () => {
                epopup.style.display = 'none';
            }); 
        </script>


        <style type="text/css" media="print">
            @page {
                size: landscape;
            }
        </style>

        <script>
            //Create PDf from HTML...
            $('#btnExport').click(function () {

                $('#map, #txtPathConflicts').printThis();



                // print($('#Navbar'));
                // CreatePDFfromHTML()
                // html2canvas();
            });





// function CreatePDFfromHTML() {
//     var HTML_Width = $('#map').width();
//     var HTML_Height = $('#map').height();
//     var top_left_margin = 15;
//     var PDF_Width = HTML_Width + (top_left_margin * 2);
//     var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
//     var canvas_image_width = HTML_Width;
//     var canvas_image_height = HTML_Height;

//     var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

//     html2canvas($('#map')[0]).then(function (canvas) {
//         var imgData = canvas.toDataURL("image/jpeg", 1.0);
//         var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
//         pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
//         for (var i = 1; i <= totalPDFPages; i++) { 
//             pdf.addPage(PDF_Width, PDF_Height);
//             pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
//         }
//         pdf.save("Exported_Map");
//         $(".html-content").hide();
//     });
// }
        </script>
</body>

</html>